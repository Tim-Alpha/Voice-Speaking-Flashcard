<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Voice-Speaking Flashcard App</title>
    <style>
      :root {
        --primary: #4f46e5;
        --primary-hover: #4338ca;
        --danger: #ef4444;
        --danger-hover: #dc2626;
        --bg-color: #f3f4f6;
        --card-bg: #ffffff;
        --text-main: #1f2937;
        --text-muted: #6b7280;
        --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: system-ui, -apple-system, sans-serif;
        background-color: var(--bg-color);
        color: var(--text-main);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
        line-height: 1.5;
      }

      .container {
        width: 100%;
        max-width: 600px;
        margin: 0 auto;
      }

      header {
        text-align: center;
        margin-bottom: 2rem;
      }

      h1 {
        font-size: 1.875rem;
        font-weight: 700;
        color: var(--text-main);
        margin-bottom: 0.5rem;
      }

      .subtitle {
        color: var(--text-muted);
        font-size: 0.875rem;
      }

      /* Study Mode Styles */
      .study-area {
        margin-bottom: 3rem;
      }

      .card-container {
        perspective: 1000px;
        height: 300px;
        width: 100%;
        margin-bottom: 1.5rem;
        cursor: pointer;
      }

      .card {
        position: relative;
        width: 100%;
        height: 100%;
        text-align: center;
        transition: transform 0.6s;
        transform-style: preserve-3d;
        border-radius: 1rem;
        box-shadow: var(--shadow);
      }

      .card.flipped {
        transform: rotateY(180deg);
      }

      .card-face {
        position: absolute;
        width: 100%;
        height: 100%;
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background-color: var(--card-bg);
        border-radius: 1rem;
        padding: 2rem;
      }

      .card-face.back {
        transform: rotateY(180deg);
        background-color: #f9fafb;
      }

      .card-label {
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--text-muted);
        margin-bottom: 1rem;
      }

      .card-text {
        font-size: 1.5rem;
        font-weight: 600;
        overflow-wrap: break-word;
        max-width: 100%;
      }

      .speak-btn-card {
        margin-top: 1.5rem;
        background: none;
        border: 1px solid #e5e7eb;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        color: var(--primary);
        transition: all 0.2s;
      }

      .speak-btn-card:hover {
        background-color: #eff6ff;
        border-color: var(--primary);
      }

      .controls {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        background: white;
        padding: 1.5rem;
        border-radius: 1rem;
        box-shadow: var(--shadow);
      }

      .nav-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .btn {
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        border: none;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.2s;
        font-size: 0.875rem;
      }

      .btn-primary {
        background-color: var(--primary);
        color: white;
      }

      .btn-primary:hover {
        background-color: var(--primary-hover);
      }

      .btn-secondary {
        background-color: #e5e7eb;
        color: var(--text-main);
      }

      .btn-secondary:hover {
        background-color: #d1d5db;
      }

      .btn-danger {
        background-color: var(--danger);
        color: white;
      }

      .btn-danger:hover {
        background-color: var(--danger-hover);
      }

      .progress-text {
        font-size: 0.875rem;
        color: var(--text-muted);
        font-weight: 500;
      }

      .audio-settings {
        display: flex;
        gap: 1rem;
        align-items: center;
        flex-wrap: wrap;
        padding-top: 1rem;
        border-top: 1px solid #f3f4f6;
      }

      select {
        flex: 1;
        padding: 0.5rem;
        border: 1px solid #d1d5db;
        border-radius: 0.5rem;
        font-size: 0.875rem;
        background-color: white;
        min-width: 150px;
      }

      .toggle-label {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.875rem;
        cursor: pointer;
        user-select: none;
      }

      /* Deck Manager Styles */
      .deck-manager {
        background: white;
        padding: 1.5rem;
        border-radius: 1rem;
        box-shadow: var(--shadow);
      }

      .section-title {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .add-card-form {
        display: grid;
        gap: 1rem;
        margin-bottom: 2rem;
      }

      .input-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      label {
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--text-muted);
        text-transform: uppercase;
      }

      input[type="text"] {
        padding: 0.75rem;
        border: 1px solid #d1d5db;
        border-radius: 0.5rem;
        font-size: 1rem;
        transition: border-color 0.2s;
      }

      input[type="text"]:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
      }

      .card-list {
        list-style: none;
        border-top: 1px solid #f3f4f6;
      }

      .card-list-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 0;
        border-bottom: 1px solid #f3f4f6;
      }

      .item-content {
        flex: 1;
        margin-right: 1rem;
      }

      .item-front {
        font-weight: 500;
        margin-bottom: 0.25rem;
      }

      .item-back {
        font-size: 0.875rem;
        color: var(--text-muted);
      }

      .delete-btn {
        background: none;
        border: none;
        color: #9ca3af;
        cursor: pointer;
        padding: 0.5rem;
        border-radius: 0.375rem;
        transition: all 0.2s;
      }

      .delete-btn:hover {
        color: var(--danger);
        background-color: #fee2e2;
      }

      .empty-state {
        text-align: center;
        padding: 3rem 1rem;
        color: var(--text-muted);
      }

      /* Responsive adjustments */
      @media (min-width: 640px) {
        .add-card-form {
          grid-template-columns: 1fr 1fr auto;
          align-items: end;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>Flashcard Speaker</h1>
        <p class="subtitle">Study, Flip, and Listen</p>
      </header>

      <!-- Study Mode -->
      <main class="study-area" id="studyArea">
        <div class="card-container" id="cardContainer">
          <div class="card" id="flashcard">
            <div class="card-face front">
              <span class="card-label">Question</span>
              <p class="card-text" id="cardFrontText">Loading...</p>
              <button class="speak-btn-card" id="speakFrontBtn" title="Listen">
                <svg
                  width="20"
                  height="20"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"
                  ></path>
                </svg>
              </button>
            </div>
            <div class="card-face back">
              <span class="card-label">Answer</span>
              <p class="card-text" id="cardBackText">Loading...</p>
              <button class="speak-btn-card" id="speakBackBtn" title="Listen">
                <svg
                  width="20"
                  height="20"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"
                  ></path>
                </svg>
              </button>
            </div>
          </div>
        </div>

        <div class="controls">
          <div class="nav-controls">
            <button class="btn btn-secondary" id="prevBtn">Previous</button>
            <span class="progress-text" id="progressText">Card 1 of 3</span>
            <button class="btn btn-primary" id="nextBtn">Next</button>
          </div>
          <div class="audio-settings">
            <select id="voiceSelect">
              <option value="">Loading voices...</option>
            </select>
            <label class="toggle-label">
              <input type="checkbox" id="autoSpeakToggle" />
              Auto-speak
            </label>
          </div>
        </div>
      </main>

      <!-- Deck Manager -->
      <section class="deck-manager">
        <div class="section-title">
          <span>Manage Deck</span>
          <button
            class="btn btn-danger"
            id="clearDeckBtn"
            style="font-size: 0.75rem; padding: 0.25rem 0.5rem"
          >
            Clear All
          </button>
        </div>

        <form class="add-card-form" id="addCardForm">
          <div class="input-group">
            <label for="newFront">Front Text</label>
            <input
              type="text"
              id="newFront"
              placeholder="e.g., Apple"
              required
            />
          </div>
          <div class="input-group">
            <label for="newBack">Back Text</label>
            <input
              type="text"
              id="newBack"
              placeholder="e.g., Manzana"
              required
            />
          </div>
          <button type="submit" class="btn btn-primary">Add Card</button>
        </form>

        <div id="cardListContainer">
          <ul class="card-list" id="cardList">
            <!-- List items will be injected here -->
          </ul>
        </div>
      </section>
    </div>

    <script>
      // --- State Management ---
      const STORAGE_KEY = "flashcards";
      const DEMO_DECK = [
        { id: 1, front: "Hello", back: "Hola" },
        { id: 2, front: "Cat", back: "Gato" },
        { id: 3, front: "Thank you", back: "Gracias" },
      ];

      let deck = [];
      let currentIndex = 0;
      let isFlipped = false;
      let voices = [];
      let synth = window.speechSynthesis;

      // --- DOM Elements ---
      const cardContainer = document.getElementById("cardContainer");
      const flashcard = document.getElementById("flashcard");
      const cardFrontText = document.getElementById("cardFrontText");
      const cardBackText = document.getElementById("cardBackText");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");
      const progressText = document.getElementById("progressText");
      const voiceSelect = document.getElementById("voiceSelect");
      const autoSpeakToggle = document.getElementById("autoSpeakToggle");
      const speakFrontBtn = document.getElementById("speakFrontBtn");
      const speakBackBtn = document.getElementById("speakBackBtn");
      const addCardForm = document.getElementById("addCardForm");
      const newFrontInput = document.getElementById("newFront");
      const newBackInput = document.getElementById("newBack");
      const cardList = document.getElementById("cardList");
      const clearDeckBtn = document.getElementById("clearDeckBtn");
      const studyArea = document.getElementById("studyArea");

      // --- Initialization ---
      function init() {
        loadDeck();
        loadVoices();
        renderStudyMode();
        renderDeckManager();

        // Event Listeners
        cardContainer.addEventListener("click", handleCardClick);
        prevBtn.addEventListener("click", prevCard);
        nextBtn.addEventListener("click", nextCard);
        addCardForm.addEventListener("submit", addCard);
        clearDeckBtn.addEventListener("click", clearDeck);

        // Speak buttons (stop propagation to prevent flip)
        speakFrontBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          speak(deck[currentIndex].front);
        });
        speakBackBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          speak(deck[currentIndex].back);
        });

        // Voice loading
        if (speechSynthesis.onvoiceschanged !== undefined) {
          speechSynthesis.onvoiceschanged = loadVoices;
        }
      }

      // --- Logic ---

      function loadDeck() {
        const stored = localStorage.getItem(STORAGE_KEY);
        if (stored) {
          deck = JSON.parse(stored);
        } else {
          deck = [...DEMO_DECK]; // Copy demo deck
          saveDeck();
        }
      }

      function saveDeck() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(deck));
        renderDeckManager();
      }

      function loadVoices() {
        voices = synth.getVoices();
        voiceSelect.innerHTML = "";

        // Filter for useful voices if possible, or just list all
        // Sort by name
        voices.sort((a, b) => a.name.localeCompare(b.name));

        voices.forEach((voice, index) => {
          const option = document.createElement("option");
          option.textContent = `${voice.name} (${voice.lang})`;
          option.value = index;

          // Try to select a default English voice
          if (voice.default) {
            option.selected = true;
          }
          voiceSelect.appendChild(option);
        });

        if (voices.length === 0) {
          const option = document.createElement("option");
          option.textContent = "No voices available";
          voiceSelect.appendChild(option);
        }
      }

      function speak(text) {
        if (synth.speaking) {
          synth.cancel();
        }

        if (text !== "") {
          const utterThis = new SpeechSynthesisUtterance(text);
          const selectedOption = voiceSelect.selectedOptions[0]?.value;

          if (selectedOption && voices[selectedOption]) {
            utterThis.voice = voices[selectedOption];
          }

          synth.speak(utterThis);
        }
      }

      // --- Study Mode UI ---

      function renderStudyMode() {
        if (deck.length === 0) {
          cardFrontText.textContent = "No cards available";
          cardBackText.textContent = "Add some cards below!";
          progressText.textContent = "0 of 0";
          flashcard.classList.remove("flipped");
          isFlipped = false;
          prevBtn.disabled = true;
          nextBtn.disabled = true;
          speakFrontBtn.style.display = "none";
          speakBackBtn.style.display = "none";
          return;
        }

        prevBtn.disabled = false;
        nextBtn.disabled = false;
        speakFrontBtn.style.display = "flex";
        speakBackBtn.style.display = "flex";

        // Ensure index is valid
        if (currentIndex >= deck.length) currentIndex = 0;
        if (currentIndex < 0) currentIndex = deck.length - 1;

        const card = deck[currentIndex];
        cardFrontText.textContent = card.front;
        cardBackText.textContent = card.back;
        progressText.textContent = `Card ${currentIndex + 1} of ${deck.length}`;

        // Reset flip state when changing cards
        if (isFlipped) {
          flashcard.classList.remove("flipped");
          isFlipped = false;
        }

        // Auto-speak front if enabled
        if (autoSpeakToggle.checked) {
          // Small delay to allow transition
          setTimeout(() => speak(card.front), 300);
        }
      }

      function handleCardClick(e) {
        if (deck.length === 0) return;

        // Don't flip if clicking buttons
        if (
          e.target.closest("button") ||
          e.target.closest("select") ||
          e.target.closest("input")
        )
          return;

        flashcard.classList.toggle("flipped");
        isFlipped = !isFlipped;

        if (isFlipped && autoSpeakToggle.checked) {
          speak(deck[currentIndex].back);
        }
      }

      function nextCard() {
        if (deck.length === 0) return;
        currentIndex = (currentIndex + 1) % deck.length;
        renderStudyMode();
      }

      function prevCard() {
        if (deck.length === 0) return;
        currentIndex = (currentIndex - 1 + deck.length) % deck.length;
        renderStudyMode();
      }

      // --- Deck Manager UI ---

      function renderDeckManager() {
        cardList.innerHTML = "";

        if (deck.length === 0) {
          cardList.innerHTML =
            '<li class="empty-state">No cards in deck. Add one above!</li>';
          return;
        }

        deck.forEach((card, index) => {
          const li = document.createElement("li");
          li.className = "card-list-item";
          li.innerHTML = `
                    <div class="item-content">
                        <div class="item-front">${escapeHtml(card.front)}</div>
                        <div class="item-back">${escapeHtml(card.back)}</div>
                    </div>
                    <button class="delete-btn" onclick="deleteCard(${index})" title="Delete Card">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                `;
          cardList.appendChild(li);
        });
      }

      function addCard(e) {
        e.preventDefault();
        const front = newFrontInput.value.trim();
        const back = newBackInput.value.trim();

        if (front && back) {
          const newCard = {
            id: Date.now(),
            front: front,
            back: back,
          };
          deck.push(newCard);
          saveDeck();
          newFrontInput.value = "";
          newBackInput.value = "";
          newFrontInput.focus();

          // If this was the first card, update study mode
          if (deck.length === 1) {
            currentIndex = 0;
            renderStudyMode();
          }
        }
      }

      // Exposed to global scope for onclick in HTML
      window.deleteCard = function (index) {
        // Removed confirm() to ensure it works in all environments
        deck.splice(index, 1);
        saveDeck();

        // Adjust current index if needed
        if (currentIndex >= deck.length) {
          currentIndex = Math.max(0, deck.length - 1);
        }
        renderStudyMode();
      };

      let clearConfirmTimer;
      function clearDeck() {
        const btn = document.getElementById("clearDeckBtn");

        if (btn.dataset.confirming === "true") {
          // Actually clear
          deck = [];
          saveDeck();
          currentIndex = 0;
          renderStudyMode();

          // Reset button
          btn.textContent = "Clear All";
          btn.style.backgroundColor = ""; // Reset to danger color class
          delete btn.dataset.confirming;
          clearTimeout(clearConfirmTimer);
        } else {
          // First click - ask for confirmation
          btn.textContent = "Confirm Clear?";
          btn.style.backgroundColor = "#dc2626"; // Darker red
          btn.dataset.confirming = "true";

          // Reset after 3 seconds if not clicked
          clearConfirmTimer = setTimeout(() => {
            btn.textContent = "Clear All";
            btn.style.backgroundColor = "";
            delete btn.dataset.confirming;
          }, 3000);
        }
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      // Start
      init();
    </script>
  </body>
</html>
